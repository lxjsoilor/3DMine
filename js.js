function $(e){return document.getElementsByClassName(e)[0]}function loadImg(e,t){var n={},o=0,a=document.getElementById("resource"),r=a.children[0].children[0],i=0;console.log(r);var s;s=setInterval(function(){var e=++i%5;0==e?r.innerHTML=".":1==e?r.innerHTML="..":2==e?r.innerHTML="...":3==e?r.innerHTML="....":4==e?r.innerHTML=".....":5==e&&(r.innerHTML="......")},300);for(var l=0;l<e.length;l++){var c=new Image;c.src="./images/"+e[l]+".png",n[e[l]]=c,c.onload=function(){++o==e.length&&(t(n),console.log(o),clearInterval(s),a.style.display="none")}}}document.onselectstart=new Function("event.returnValue=false;");var game={data:[],rows:18,cols:24,temp:!0,time:60,leftTimer:null,isOver:!1,mineNum:0,randomNumber:function(e){var t=0,n=e.className.split(" ");if(1==n.length)for(var o=n[0].split("."),a=parseInt(o[0]),r=parseInt(o[1]);t<20;)$((a=Math.ceil(this.rows*Math.random())-1)+"."+(r=Math.ceil(this.cols*Math.random())-1)).id||($(a+"."+r).id="mine",t++);else if(4==n.length)for(;t<20;)for(var i=!0,a=Math.ceil(this.rows*Math.random())-1,r=Math.ceil(this.cols*Math.random())-1,s=0;s<n.length;s++){var o=n[s].split("."),l=parseInt(o[0]),c=parseInt(o[1]);if(a==l&&r==c){i=!1;break}$(a+"."+r).id&&1==i||($(a+"."+r).id="mine",t++)}for(s=0;s<this.rows;s++)for(var m=0;m<this.cols;m++){$(s+"."+m).style.transition="0.2s all",$(s+"."+m).style.backgroundColor="#173825";var g=0;s-1>=0&&m-1>=0&&"mine"==$(s-1+"."+(m-1)).id&&g++,s>=1&&"mine"==$(s-1+"."+m).id&&g++,s-1>=0&&m<=this.cols-2&&"mine"==$(s-1+"."+(m+1)).id&&g++,m>=1&&"mine"==$(s+"."+(m-1)).id&&g++,m<=this.cols-2&&"mine"==$(s+"."+(m+1)).id&&g++,s<=this.rows-2&&m-1>=0&&"mine"==$(s+1+"."+(m-1)).id&&g++,s<=this.rows-2&&"mine"==$(s+1+"."+m).id&&g++,s<=this.rows-2&&m<=this.cols-2&&"mine"==$(s+1+"."+(m+1)).id&&g++,$(s+"."+m).id||($(s+"."+m).id=g+"")}},onclick:function(){for(var e=this,t=0;t<this.rows;t++)for(var n=0;n<this.cols;n++)$(t+"."+n).onclick=function(){if(e.temp&&(e.randomNumber(this),e.temp=!1),"sure"!=this.dataset.sign&&!e.isOver){if(this.style.backgroundColor="","mine"==this.id)return e.gameOver(),void e.rock();"0"==this.id?(e.showSpace(this),this.innerHTML=this.id):this.innerHTML=this.id,e.changeImg()}},$(t+"."+n).oncontextmenu=function(){if(!this.dataset.sign){var t=0;this.dataset.sign="sure",e.judge(),e.changeImg();for(var n=$("box").children,o=0;o<n.length;o++)for(var a=0;a<n[o].children.length;a++)"sure"==n[o].children[a].dataset.sign&&t++;return $("hasMine").innerHTML=20-t,!1}return"sure"==this.dataset.sign?(this.dataset.sign="issue",e.changeImg(),!1):"issue"==this.dataset.sign?(this.dataset.sign="",e.changeImg(),!1):void 0}},showSpace:function(e){var t=e.className.split(" ");if(1==t.length){var n=t[0].split("."),o=parseInt(n[0]),a=parseInt(n[1]);this.ifSpace(o,a)}if(4==t.length)for(var r=0;r<t.length;r++){var n=t[r].split("."),o=parseInt(n[0]),a=parseInt(n[1]);this.ifSpace(o,a)}},ifSpace:function(e,t){if(e-1>=0&&t-1>=0&&("0"!=(n=$(e-1+"."+(t-1))).id&&(n.innerHTML="mine"==n.id?"":n.id,n.style.backgroundColor=""),"0"==n.id&&n.style.backgroundColor&&(n.innerHTML=n.id,n.style.backgroundColor="",n.style.backgroundImage="url('./images/actcell.png')",this.showSpace(n))),e>=1&&("0"!=(n=$(e-1+"."+t)).id&&(n.innerHTML="mine"==n.id?"":n.id,n.style.backgroundColor=""),"0"==n.id&&n.style.backgroundColor&&(n.innerHTML=n.id,n.style.backgroundColor="",n.style.backgroundImage="url('./images/actcell.png')",this.showSpace(n))),e-1>=0&&t<=this.cols-2&&("0"!=(n=$(e-1+"."+(t+1))).id&&(n.innerHTML="mine"==n.id?"":n.id,n.style.backgroundColor=""),"0"==n.id&&n.style.backgroundColor&&(n.innerHTML=n.id,n.style.backgroundColor="",n.style.backgroundImage="url('./images/actcell.png')",this.showSpace(n))),t>=1&&("0"!=(n=$(e+"."+(t-1))).id&&(n.innerHTML="mine"==n.id?"":n.id,n.style.backgroundColor=""),"0"==n.id&&n.style.backgroundColor&&(n.innerHTML=n.id,n.style.backgroundColor="",n.style.backgroundImage="url('./images/actcell.png')",this.showSpace(n))),t<=this.cols-2&&("0"!=(n=$(e+"."+(t+1))).id&&(n.innerHTML="mine"==n.id?"":n.id,n.style.backgroundColor=""),"0"==n.id&&n.style.backgroundColor&&(n.innerHTML=n.id,n.style.backgroundColor="",n.style.backgroundImage="url('./images/actcell.png')",this.showSpace(n))),e<=this.rows-2&&t-1>=0&&("0"!=(n=$(e+1+"."+(t-1))).id&&(n.innerHTML="mine"==n.id?"":n.id,n.style.backgroundColor=""),"0"==n.id&&n.style.backgroundColor&&(n.innerHTML=n.id,n.style.backgroundColor="",n.style.backgroundImage="url('./images/actcell.png')",this.showSpace(n))),e<=this.rows-2&&("0"!=(n=$(e+1+"."+t)).id&&(n.innerHTML="mine"==n.id?"":n.id,n.style.backgroundColor=""),"0"==n.id&&n.style.backgroundColor&&(n.innerHTML=n.id,n.style.backgroundColor="",n.style.backgroundImage="url('./images/actcell.png')",this.showSpace(n))),e<=this.rows-2&&t<=this.cols-2){var n=$(e+1+"."+(t+1));"0"!=n.id&&(n.innerHTML="mine"==n.id?"":n.id,n.style.backgroundColor=""),"0"==n.id&&n.style.backgroundColor&&(n.innerHTML=n.id,n.style.backgroundColor="",n.style.backgroundImage="url('./images/actcell.png')",this.showSpace(n))}},judge:function(){for(var e=!0,t=0;t<this.rows;t++)for(var n=0;n<this.cols;n++)"mine"==$(t+"."+n).id&&"sure"!=$(t+"."+n).dataset.sign&&(e=!1);e&&(clearInterval(this.leftTimer),this.success())},changeImg:function(){for(var e=0;e<this.rows;e++)for(var t=0;t<this.cols;t++)0==$(e+"."+t).innerHTML?$(e+"."+t).style.backgroundImage="url('./images/actcell.png')":1==$(e+"."+t).innerHTML?$(e+"."+t).style.backgroundImage="url('./images/mine_1.png')":2==$(e+"."+t).innerHTML?$(e+"."+t).style.backgroundImage="url('./images/mine_2.png')":3==$(e+"."+t).innerHTML?$(e+"."+t).style.backgroundImage="url('./images/mine_3.png')":4==$(e+"."+t).innerHTML?$(e+"."+t).style.backgroundImage="url('./images/mine_4.png')":5==$(e+"."+t).innerHTML?$(e+"."+t).style.backgroundImage="url('./images/mine_5.png')":6==$(e+"."+t).innerHTML?$(e+"."+t).style.backgroundImage="url('./images/mine_6.png')":7==$(e+"."+t).innerHTML?$(e+"."+t).style.backgroundImage="url('./images/mine_7.png')":8==$(e+"."+t).innerHTML&&($(e+"."+t).style.backgroundImage="url('./images/mine_8.png')"),$(e+"."+t).innerHTML||("sure"==$(e+"."+t).dataset.sign&&($(e+"."+t).style.backgroundImage="url('./images/sign.png')"),"issue"==$(e+"."+t).dataset.sign&&($(e+"."+t).style.backgroundImage="url('./images/querycell.png')"),$(e+"."+t).dataset.sign||($(e+"."+t).style.backgroundImage=""))},gameOver:function(){clearInterval(this.leftTimer);for(var e=0;e<this.rows;e++)for(var t=0;t<this.cols;t++)if("mine"==$(e+"."+t).id&&($(e+"."+t).style.backgroundImage="url('./images/mine.png')"),0!=$(e+"."+t).id&&"mine"!=$(e+"."+t).id){var n=parseInt($(e+"."+t).id);$(e+"."+t).style.backgroundImage="url('./images/mine_"+n+".png')"}},rock:function(){var e=this,t=null;$("bowmusic").play(),t=setInterval(function(){var e=Math.abs(80*Math.random()-20)/2,t=Math.abs(80*Math.random()-20)/2;$("box").style.marginLeft=e-180+"px",$("box").style.marginTop=t-180+"px"},20),setTimeout(function(){$("box").style.left="50%",$("box").style.top="50%",clearInterval(t),e.isOver=!e.isOver,$("box").style.perspective="1000px";for(var n=$("box").children,o=0;o<n.length;o++){n[o].style.backgroundColor="transparent";for(var a=0;a<n[o].children.length;a++){n[o].children[a].style.transition="0.5s all";var r=1e3*Math.random()-500,i=600*Math.random()-300,s=600*Math.random()-300,l=360*Math.random(),c=360*Math.random(),m=360*Math.random();n[o].children[a].style.transform="translate3d("+r+"px, "+i+"px, "+s+"px) rotateX("+l+"deg) rotateY("+c+"deg) rotateZ("+m+"deg)"}}$("replay").style.bottom="100px",e.replay()},400)},success:function(){var e=this;$("box").style.transition="0.3s all",$("box").style.transform="rotateX("+(control.pX+control.y/4)+"deg) rotateY("+(control.pY+control.x/4)+"deg) scale3d("+1.4*control.boxScale+","+1.4*control.boxScale+","+1.4*control.boxScale+")",$("box").addEventListener("transitionend",function(){$("box").style.transition="0.5s all",$("box").style.transform="rotateX("+(control.pX+control.y/4)+"deg) rotateY("+(control.pY+control.x/4)+"deg) scale3d("+0*control.boxScale+","+0*control.boxScale+","+0*control.boxScale+")"}),setTimeout(function(){e.nextGame()},700)},replay:function(){var e=this;$("replay").onclick=function(){$("box").style.perspective="";for(var t=$("box").children,n=0;n<t.length;n++){t[n].style.backgroundColor="transparent";for(var o=0;o<t[n].children.length;o++)t[n].children[o].style.backgroundImage="url('./images/noactcell.png')",t[n].children[o].id="",t[n].children[o].dataset.sign="",t[n].children[o].innerHTML="",t[n].children[o].style.transform="",t[n].children[o].style.transition="0.5s all"}e.isOver=!e.isOver,e.temp=!0,$("replay").style.bottom="-10%",e.time=60;var a=!0;$("tab_red").style.opacity=0,e.leftTimer=setInterval(function(){e.time--,e.time<=15&&($("tab_red").style.opacity=a?.9:.1,console.log(77)),a=!a,e.time<=0&&(clearInterval(e.leftTimer),e.time,e.gameOver(),e.rock()),$("hasTime").innerHTML=e.time},1e3),$("hasMine").innerHTML=20}},nextGame:function(){$("next_game").style.transform="scale(1)",$("next_game").onclick=function(){window.location.reload()}},setTime:function(){var e=this,t=!0;this.leftTimer=setInterval(function(){e.time--,e.time<=15&&($("tab_red").style.opacity=t?.9:.1),t=!t,0==e.time&&(clearInterval(e.leftTimer),e.time,e.gameOver(),e.rock()),$("hasTime").innerHTML=e.time},1e3)}},control={body:document.body,box:$("box"),cover:$("cover"),button:$("button"),control:$("control"),controlBox:$("control_box"),timer:null,flag:!1,x:0,y:0,sStr:0,yStr:0,pX:-10,pY:-30,xx:0,yy:0,barYY:0,upBarY:0,boxScale:1,forBUG:0,isStop:!1,mouseMove:function(e){var t=this;this.body.onmousedown=function(e){e.stopPropagation(),t.flag=!0,t.xx=e.pageX,t.yy=e.pageY},this.body.onmousemove=function(e){e.stopPropagation(),t.flag&&(t.x=e.pageX-t.xx,t.y=e.pageY-t.yy,t.box.style.transform="rotateX("+(t.pX+t.y/-4)+"deg) rotateY("+(t.pY+t.x/4)+"deg) scale3d("+t.boxScale+","+t.boxScale+","+t.boxScale+")")},this.body.onmouseup=function(e){e.stopPropagation(),t.flag=!1;var n=t.box.style.transform;t.xStr=n.slice(0,n.indexOf(" ")),t.yStr=n.slice(n.indexOf(" "),n.indexOf("scale3d")),t.pX=t.xStr.replace(/[^0-9.-]/gi,""),t.pX=parseInt(t.pX),t.pY=t.yStr.replace(/[^0-9.-]/gi,""),t.pY=parseInt(t.pY),t.control.onmousemove=null,t.upBarY=t.barYY}},autoRotate:function(){var e=this;this.timer=setInterval(function(){e.pY+=1,e.box.style.transform="rotateX(-10deg) rotateY("+e.pY+"deg) scale3d(0.5,0.5,0.5)"},60)},returnFalse:function(e){this.cover.onclick=function(e){e.stopPropagation()},this.cover.onmousedown=function(e){e.stopPropagation()},this.cover.onmousemove=function(e){e.stopPropagation()},this.cover.onmouseup=function(e){e.stopPropagation()}},startGame:function(e){var t=this;control.stopBtn(),control.musicBtn(),this.button.onclick=function(e){game.setTime(),t.box.style.transform="rotateX(-10deg) rotateY("+t.pY+"deg) scale3d(1,1,1)",this.style.bottom="-10%",this.addEventListener("transitionend",function(){t.cover.style.display="none"}),t.box.addEventListener("transitionend",function(){t.box.style.transition="none"}),t.control.style.right="100px",t.controlBar(),clearInterval(t.timer),$("time_tab").style.left="40px",$("mine_tab").style.left="40px",$("play_btn").style.top="30px",$("music_play_btn").style.top="30px"}},controlBar:function(e){var t=this;this.controlBox.onmousedown=function(e){e.stopPropagation();var n=e.pageY;t.control.onmousemove=function(e){e.stopPropagation(),t.barYY=e.pageY-n+t.upBarY,t.barYY=t.barYY>170?170:t.barYY,t.barYY=t.barYY<-170?-170:t.barYY,t.controlBox.style.transform="translateY("+t.barYY+"px)",t.boxScale=1+.003*t.barYY,t.box.style.transform="rotateX("+(t.pX+t.y/4)+"deg) rotateY("+(t.pY+t.x/4)+"deg) scale3d("+t.boxScale+","+t.boxScale+","+t.boxScale+")"}}},stopBtn:function(){var e=this;$("play_btn").onclick=function(t){if(t.stopPropagation(),e.isStop=!e.isStop,e.isStop)$("play_cover").style.display="block",setTimeout(function(){$("play_cover").style.opacity=.5},0),clearInterval(game.leftTimer),$("play_btn").style.backgroundImage="url(./images/play_btn2.png)";else{$("play_cover").style.opacity=0,setTimeout(function(){$("play_cover").style.display="none"},500),clearInterval(game.leftTimer),$("play_btn").style.backgroundImage="url(./images/stop_btn.png)";var n=!0;game.leftTimer=setInterval(function(){game.time--,game.time<=15&&($("tab_red").style.opacity=n?.9:.1),n=!n,game.time<=0&&(clearInterval(game.leftTimer),game.time,game.gameOver(),game.rock()),$("hasTime").innerHTML=game.time},1e3)}},$("play_btn").onmousedown=function(e){e.stopPropagation()},$("play_btn").onmousedown=function(e){e.stopPropagation()},$("play_btn").onmouseup=function(e){e.stopPropagation()},$("play_cover").onmousedown=function(e){e.stopPropagation()},$("play_cover").onmousedown=function(e){e.stopPropagation()},$("play_cover").onmouseup=function(e){e.stopPropagation()}},musicBtn:function(){var e=!0;$("music_play_btn").onclick=function(t){t.stopPropagation(),e?($("bgmusic").pause(),e=!e,$("music_play_btn").style.backgroundImage="url(./images/music_btn.png)"):($("bgmusic").play(),e=!e,$("music_play_btn").style.backgroundImage="url(./images/music_btn_stop.png)")},$("music_play_btn").onmousedown=function(e){e.stopPropagation()},$("music_play_btn").onmousemove=function(e){e.stopPropagation()},$("music_play_btn").onmouseup=function(e){e.stopPropagation()}}};$("bgmusic").volume=.3;var imgArr=["actcell","noactcell","continue","querycell","control_bar","control_box","ice_bg","mine_1","mine_2","mine_3","mine_4","mine_5","mine_6","mine_7","mine_8","mine_bg","mine","music_btn_stop","music_btn","play_btn","play_btn2","replay_btn","sign","stop_btn","tab","tabred"];loadImg(imgArr,function(){control.mouseMove(),control.autoRotate(),control.returnFalse(),control.startGame(),game.onclick()});